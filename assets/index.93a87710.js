(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();class p{constructor(t="",i=0,s=0,e=0,n=0){this.img=new Image,this.img.src=t,this.width=i,this.height=s,this.x=e,this.y=n,this.visible=!0}drawToCanvas(t){!this.visible||t.drawImage(this.img,this.x,this.y,this.width,this.height)}isCollideWith(t){const i=t.x+t.width/2,s=t.y+t.height/2;return!this.visible||!t.visible?!1:i>=this.x&&i<=this.x+this.width&&s>=this.y&&s<=this.y+this.height}}const y={poolDic:Symbol("poolDic")};class G{constructor(){this[y.poolDic]={}}getPoolBySign(t){return this[y.poolDic][t]||(this[y.poolDic][t]=[])}getItemByClass(t,i){const s=this.getPoolBySign(t);return s.length?s.shift():new i}recover(t,i){this.getPoolBySign(t).push(i)}}let w;class m{constructor(){if(w)return w;w=this,this.pool=new G,this.reset()}reset(){this.frame=0,this.score=0,this.bullets=[],this.enemys=[],this.animations=[],this.gameOver=!1}removeEnemey(t){const i=this.enemys.shift();i.visible=!1,this.pool.recover("enemy",t)}removeBullets(t){const i=this.bullets.shift();i.visible=!1,this.pool.recover("bullet",t)}}const S="images/bullet.png",Y=16,C=30,_={speed:Symbol("speed")},O=new m;class D extends p{constructor(){super(S,Y,C)}init(t,i,s){this.x=t,this.y=i,this[_.speed]=s,this.visible=!0}update(){this.y-=this[_.speed],this.y<-this.height&&O.removeBullets(this)}}const v=window.innerWidth,b=window.innerHeight,X="images/hero.png",$=80,M=80,L=new m,E=document.body.ontouchstart===void 0;class W extends p{constructor(){super(X,$,M),this.x=v/2-this.width/2,this.y=b-this.height-30,this.touched=!1,this.bullets=[],this.initEvent()}checkIsFingerOnAir(t,i){return t>=this.x-30&&i>=this.y-30&&t<=this.x+this.width+30&&i<=this.y+this.height+30}setAirPosAcrossFingerPosZ(t,i){let s=t-this.width/2,e=i-this.height/2;s<0?s=0:s>v-this.width&&(s=v-this.width),e<=0?e=0:e>b-this.height&&(e=b-this.height),this.x=s,this.y=e}initEvent(){canvas.addEventListener(E?"mousedown":"touchstart",t=>{var e,n,r,c;t.preventDefault();const i=((n=(e=t.touches)==null?void 0:e[0])==null?void 0:n.clientX)||t.clientX,s=((c=(r=t.touches)==null?void 0:r[0])==null?void 0:c.clientY)||t.clientY;this.checkIsFingerOnAir(i,s)&&(this.touched=!0,this.setAirPosAcrossFingerPosZ(i,s))}),canvas.addEventListener(E?"mousemove":"touchmove",t=>{var e,n,r,c;t.preventDefault();const i=((n=(e=t.touches)==null?void 0:e[0])==null?void 0:n.clientX)||t.clientX,s=((c=(r=t.touches)==null?void 0:r[0])==null?void 0:c.clientY)||t.clientY;this.touched&&this.setAirPosAcrossFingerPosZ(i,s)}),canvas.addEventListener(E?"mouseup":"touchend",t=>{t.preventDefault(),this.touched=!1})}shoot(){const t=L.pool.getItemByClass("bullet",D);t.init(this.x+this.width/2-t.width/2,this.y-10,10),L.bullets.push(t)}}const F=new m,f={timer:Symbol("timer")};class R extends p{constructor(t,i,s){super(t,i,s),this.isPlaying=!1,this.loop=!1,this.interval=1e3/60,this[f.timer]=null,this.index=-1,this.count=0,this.imgList=[],F.animations.push(this)}initFrames(t){t.forEach(i=>{const s=new Image;s.src=i,this.imgList.push(s)}),this.count=t.length}aniRender(t){t.drawImage(this.imgList[this.index],this.x,this.y,this.width*1.2,this.height*1.2)}playAnimation(t=0,i=!1){this.visible=!1,this.isPlaying=!0,this.loop=i,this.index=t,this.interval>0&&this.count&&(this[f.timer]=setInterval(this.frameLoop.bind(this),this.interval))}stop(){this.isPlaying=!1,this[f.timer]&&clearInterval(this[f.timer])}frameLoop(){this.index++,this.index>this.count-1&&(this.loop?this.index=0:(this.index--,this.stop()))}}const N="images/enemy.png",P=60,k=60,H={speed:Symbol("speed")},U=new m;function q(h,t){return Math.floor(Math.random()*(t-h)+h)}class Z extends R{constructor(){super(N,P,k),this.initExplosionAnimation()}init(t){this.x=q(0,window.innerWidth-P),this.y=-this.height,this[H.speed]=t,this.visible=!0}initExplosionAnimation(){const t=[],i="images/explosion";for(let e=0;e<19;e++)t.push(`${i+(e+1)}.png`);this.initFrames(t)}update(){this.y+=this[H.speed],this.y>window.innerHeight+this.height&&U.removeEnemey(this)}}const B=window.innerWidth,g=window.innerHeight,j="images/bg.jpg",K=512,z=512;class J extends p{constructor(t){super(j,K,z),this.top=0,this.render(t)}update(){this.top+=2,this.top>=g&&(this.top=0)}render(t){t.drawImage(this.img,0,0,this.width,this.height,0,-g+this.top,B,g),t.drawImage(this.img,0,0,this.width,this.height,0,this.top,B,g)}}const d=window.innerWidth,u=window.innerHeight,I=new Image;I.src="images/Common.png";class Q{renderGameScore(t,i){t.fillStyle="#ffffff",t.font="20px Arial",t.fillText(i,10,30)}renderGameOver(t,i){t.drawImage(I,0,0,119,108,d/2-150,u/2-100,300,300),t.fillStyle="#ffffff",t.font="20px Arial",t.fillText("\u6E38\u620F\u7ED3\u675F",d/2-40,u/2-100+50),t.fillText(`\u5F97\u5206: ${i}`,d/2-40,u/2-100+130),t.drawImage(I,120,6,39,24,d/2-60,u/2-100+180,120,40),t.fillText("\u91CD\u65B0\u5F00\u59CB",d/2-40,u/2-100+205),this.btnArea={startX:d/2-40,startY:u/2-100+180,endX:d/2+50,endY:u/2-100+255}}}let A;class V{constructor(){if(A)return A;A=this,this.bgmAudio=new Audio,this.bgmAudio.loop=!0,this.bgmAudio.src="audio/bgm.mp3",this.shootAudio=new Audio,this.shootAudio.src="audio/bullet.mp3",this.boomAudio=new Audio,this.boomAudio.src="audio/boom.mp3",this.playBgm()}playBgm(){this.bgmAudio.play()}playShoot(){this.shootAudio.currentTime=0,this.shootAudio.play()}playExplosion(){this.boomAudio.currentTime=0,this.boomAudio.play()}}const l=document.getElementById("canvas");l.width=window.innerWidth;l.height=window.innerHeight;const a=l.getContext("2d"),o=new m,T=document.body.ontouchstart===void 0;class tt{constructor(){console.log(1111111),this.aniId=0,this.restart()}restart(){o.reset(),l.removeEventListener(T?"mousedown":"touchstart",this.touchHandler),this.bg=new J(a),this.player=new W(a),this.gameinfo=new Q,this.music=new V,this.bindLoop=this.loop.bind(this),this.hasEventBind=!1,window.cancelAnimationFrame(this.aniId),this.aniId=window.requestAnimationFrame(this.bindLoop,l)}enemyGenerate(){if(o.frame%16===0){const t=o.pool.getItemByClass("enemy",Z);t.init(6),o.enemys.push(t)}}collisionDetection(){const t=this;o.bullets.forEach(i=>{for(let s=0,e=o.enemys.length;s<e;s++){const n=o.enemys[s];if(!n.isPlaying&&n.isCollideWith(i)){n.playAnimation(),t.music.playExplosion(),i.visible=!1,o.score+=1;break}}});for(let i=0,s=o.enemys.length;i<s;i++){const e=o.enemys[i];if(this.player.isCollideWith(e)){o.gameOver=!0;break}}}touchEventHandler(t){var n,r,c,x;console.log(t),t.preventDefault();const i=((r=(n=t.touches)==null?void 0:n[0])==null?void 0:r.clientX)||t.clientX,s=((x=(c=t.touches)==null?void 0:c[0])==null?void 0:x.clientY)||t.clientY,e=this.gameinfo.btnArea;i>=e.startX&&i<=e.endX&&s>=e.startY&&s<=e.endY&&this.restart()}render(){a.clearRect(0,0,l.width,l.height),this.bg.render(a),o.bullets.concat(o.enemys).forEach(t=>{t.drawToCanvas(a)}),this.player.drawToCanvas(a),o.animations.forEach(t=>{t.isPlaying&&t.aniRender(a)}),this.gameinfo.renderGameScore(a,o.score),o.gameOver&&(this.gameinfo.renderGameOver(a,o.score),this.hasEventBind||(this.hasEventBind=!0,this.touchHandler=this.touchEventHandler.bind(this),l.addEventListener(T?"mousedown":"touchstart",this.touchHandler)))}update(){o.gameOver||(this.bg.update(),o.bullets.concat(o.enemys).forEach(t=>{t.update()}),this.enemyGenerate(),this.collisionDetection(),o.frame%10===0&&(this.player.shoot(),this.music.playShoot()))}loop(){o.frame++,this.update(),this.render(),this.aniId=window.requestAnimationFrame(this.bindLoop,l)}}new tt;
